<!DOCTYPE html>
<html>
<head>
    <title>Live Threat Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        #summary { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Home Network Threat Dashboard</h1>
    <div id="summary"></div>
    <table id="predictions-table">
        <thead>
            <tr id="table-header"></tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        async function fetchData() {
            const response = await fetch("/data");
            const data = await response.json();

            if (data.error) {
                document.getElementById("summary").innerText = "Error: " + data.error;
                return;
            }

            let summaryHTML = "<strong>Summary:</strong><br>";
            for (const [label, count] of Object.entries(data.summary)) {
                summaryHTML += `${label}: ${count}<br>`;
            }
            document.getElementById("summary").innerHTML = summaryHTML;

            const tableHeader = document.getElementById("table-header");
            const tableBody = document.getElementById("table-body");

            tableHeader.innerHTML = "";
            tableBody.innerHTML = "";

            if (data.rows.length > 0) {
                const headers = Object.keys(data.rows[0]);
                headers.forEach(col => {
                    const th = document.createElement("th");
                    th.innerText = col;
                    tableHeader.appendChild(th);
                });

                data.rows.forEach(row => {
                    const tr = document.createElement("tr");
                    headers.forEach(col => {
                        const td = document.createElement("td");
                        td.innerText = row[col];
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });
            }
        }

        setInterval(fetchData, 5000);
        fetchData();
    </script>
</body>
</html>
